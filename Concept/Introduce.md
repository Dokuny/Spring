# 스프링 프레임워크 소개

## 소개
* 스프링 프레임워크는 자바 엔터프라이즈 애플리케이션 개발을 단순하게 해주는 오픈 소스 애플리케이션 프레임워크
* 스프링은 여러 모듈로 이루어져 있다.
* 스프링 삼각형
  * Portable Service Abstraction(서비스 추상화)
    * 트랜잭션 추상화,OXM(Object-XML Mapping) 추상화,데이터 액세스의 Exception 변환기능 등 기술적인 복잡함은
    추상화를 통해 Low Level의 기술 구현부분과 기술을 사용하는 인터페이스로 분리한다
  * DI(Dependency Injection,의존관계 주입)
  * AOP(Aspect Objected Programming)
  * POJO(Plain Old Java Object)

* 특징
  * 컨테이너 역할
    * Spring 컨테이너는 Java 객체의 LifeCycle을 관리하며 Spring 컨테이너로부터 필요한 객체를 가져와 사용할 수 있다.
  * DI 지원
    * 설정파일(XML)이나 어노테이션을 통해서 객체간의 의존관계를 설정할 수 있도록 함
  * AOP 지원
    * 공통적으로 필요로 하는 모듈들을 실제 핵심 모듈에서 분리해서 적용할 수 있도록 함
  * POJO 지원
    * Spring 컨테이너에 저장되는 Java 객체는 특정한 인터페이스를 구현하거나, 특정클래스를 상속받지 않아도 된다.
  * 트랜잭션 처리를 위한 일관된 방법을 지원
    * 어떤 트랜잭션을 사용하던 설정을 통해 정보를 과리하므로 트랜잭션 구현에 상관없이 동일한 코드 사용가능
  * 영속성(Persistence)과 관련된 다양한 API 지원
    * MyBatis,Hibernate 등 데이터베이스 처리를 위한 ORM 프레임워크들과의 연동 지원


* Spring 프레임워크를 구성하는 기능 요소
  * Spring Core : 프레임워크의 기본기능(컨테이너) 제공,Core의 BeanFactory는 Spring의 기본 컨테이너면서 스프링 DI의 기반이다.
  * Spring AOP : AOP 지원
  * Spring ORM : ORM 프레임워크와 연결고리 제공
  * Spring DAO : JDBC에 대한 추상화 계층으로 JDBC 코딩이나 예외처리 하는 부분을 간편화 시켰으며, AOP 모듈을 이용해 트랜잭션 관리서비스 제공
  * Spring Web : 일반적인 웹애플리케이션 개발에 필요한 기본기능 제공,다른 웹애플리케이션 프레임워크와의 통합을 지원
  * Spring Context : Context 모듈은 BeanFactory(Core)의 개념을 확장한 것으로 국제화 메시지,애플리케이션 생명주기 이벤트,유호성 검증 등을 지원
  * Spring Web MVC 
***
## 스프링 모듈
* 핵심 컨테이너
  * spring-core,spring-beans : DI기능과 IoC 컨테이너 구현
  * spring-expression : 애플리케이션 객체설정에 사용하는 SpEL 지원을 제공
* AOP와 계측
  * 관점 기반 프로그래밍과 클래스 계측을 지원
  * spring-aop : AOP기능
  * spring-instrument : 클래스 계측
* 메시징
  * spring-messaging : 메시지 기반 애플리케이션을 쉽게 개발하도록 도와주는 모듈 
* 데이터 접근/통합
  * 데이터베이스나 메시징 공급자와의 상호 작용을 쉽게 해주는 모듈을 포함
  * spring-jdbc : jdbc를 사용한 데이터베이스 사용을 단순화
  * spring-orm : 객체-관계 매핑(ORM) 프레임워크 통합
  * spring-jms : JMS 공급자와의 상호 작용을 쉽게 만들어줌
  * spring-tx : 프로그램을 통해 트랜잭션 관리를 선언적으로 할 수 있음
* 웹
  * spring-web : 웹 모듈이 공통으로 사용하는 클래스와 인터페이스를 정의
  * spring-webmvc : 서블릿 기반의 웹 애플리케이션과 RESTful 웹 서비스 개발(블로킹방식)을 쉽게 해줌
  * spring-webflux : 반응형(넌블로킹방식) 웹 애플리케이션과 RESTful 웹 서비스 개발을 쉽게 해줌
  * spring-websocket : 웹소켓 프로토콜을 사용하는 웹 애플리케이션 개발 지원
* 테스트
  * spring-test : 단위 테스트와 통합 테스트를 도와준다.
***
## 스프링 IoC 컨테이너
* 객체가 다른 객체와 상호 작용하는 경우를 ``의존관계(dependency)``라고 한다.


* ``DI(Dependecny Injection,의존성 주입)``
  * 객체 간의 의존 관계를 ``constructor argument``나 ``setter method arguments``로 명시
  * 객체를 생성할 때 생성자나 세터를 통해 의존관계를 주입하는 디자인 패턴



* 스프링 IoC 컨테이너(= 스프링 컨테이너)
  * 스프링 애플리케이션에서 애플리케이션에 존재하는 객체를 생성하고 의존 관계를 주입하는 일을 담당
  * ``빈(bean)`` : 스프링 컨테이너가 생성하고 관리하는 애플리케이션 객체들
  * 애플리케이션 객체를 한꺼번에 책임지므로 디자인 패턴을 직접 구현할 필요가 없다
  * 의존 관계를 주입하는 책임은 객체가 아닌 스프링 컨테이너에 있어 DI를 IoC(제어의 역전)라고도 부른다.
  * 애플리케이션 객체와 그들의 의존 관계에 대한 정보는 ``설정 메타데이터``를 사용해 지정
  * 스프링 IoC 컨테이너는 설정 메타데이터를 읽어서 의존관계를 인스턴스화한다.
  * 스프링 컨테이너는 자바 리플렉션 API를 사용해 객체를 만들고 의존관계를 주입
  * 스프링 컨테이너에 설정 메타데이터를 제공하는 방식
    * XML
    * 자바 애너테이션
    * 자바 코드
  * 스프링 컨테이너가 애플리케이션 객체에 추가 기능을 부여하고 객체를 평범한 자바 객체(POJO,Plain Old Java Object,기존 자바 객체)로 모델링 할 수 있다.
  * POJO 클래스
    * POJO에 해당하는 자바 클래스
    * 프레임워크가 지정하는 인터페이스나 클래스를 구현 및 확장하지 않는 보통 자바 클래스에 지나지 않는다.
    * 애플리케이션에 필요한 엔터프라이즈 서비스(트랜잭션 관리,보안,원격 접근 등)는 스프링 컨테이너로 투명성 있게 POJO에 제공된다.
  * 결론 : 스프링 컨테이너는 설정 메타데이터를 읽은 후 자바 리플렉션 API를 사용해 애플리케이션 객체를 생성 및 의존관계를 주입한다.
***
## 스프링의 장점
* 스프링은 객체 생성과 의존 관계 주입을 처리함으로써 자바 애플리케이션 조합을 쉽게 만들어준다.
* 스프링은 POJO로 애플리케이션을 개발하는 것을 권장한다.
### 지역과 전역 트랜잭션을 일관성 있게 섞어서 사용하기
* 트랜잭션 : 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미


* 전통적인 접근 방식에서 여러 데이터베이스 변경을 하나의 작업 단위로 수행하려면 먼저 JDBC연결의 자동커밋 모드를 끄고 SQL명령을 실행 후  
트랜잭션을 커밋(혹은 롤백)한다. JDBC Connection과 같은 자원에 따라 정해지는 트랜잭션을 ``지역 트랜잭션``이라고 한다.
  * JDBC Connection을 사용한 트랜잭션 관리 방식은 데이터베이스를 하나만 사용하는 경우(트랜잭션 자원이 하나인 경우) 유효
  * 사용하는 트랜잭션 자원이 둘 이상이면 JTA API(Java Transaction)를 사용해 트랜잭션을 관리,JTA 트랜잭션을 ``전역 트랜잭션,분산 트랜잭션``이라 한다 
  * JTA를 사용하려면 JNDI를 사용해 UserTransaction 객체를 가져와서 프로그램이 직접 트랜잭션을 시작하고 커밋(롤백)해야한다


* 프로그램에서 트랜잭션을 직접 관리하는 방식
  * JDBC Connection(지역 트랜잭션) 사용
  * User Transaction(전역 트랜잭션) 사용
  * 지역 트랜잭션은 전역 트랜잭션 안에서 실행할 수 없다.


* 스프링은 지역과 전역 트랜잭션을 똑같이 취급할 수 있게 추상화 계층을 제공함으로써 발생할 문제를 단순화 해준다
  * 스프링의 트랜잭션 추상화 안에서 트랜잭션 관련 메서드를 작성했다면 지역 트랜잭션을 전역 트랜잭션으로 변경하거나 반대로 트랜잭션 처리방식을 바꾸기 위해 메서드를 변경할 필요가 없다!!

### 선언적 트랜잭션 관리
* 스프링을 사용하면 트랜잭션을 선언적으로 관리할 수 있다
  * 메서드에 ``@Transactional`` 애너테이션을 설정하면 스프링이 트랜잭션을 관리
  * 스프링의 트랜잭션 관리 기능을 사용하기 위해 스프링에 어떤 인터페이스나 클래스도 구현하거나 확장하지 않아도 된다.
  * 이는 스프링의 기능을 활용하기 위해 애플리케이션에서 스프링의 클래스나 인터페이스에 의존하지 않아도 된다는 사실을 뜻하고 이는 스프링이 ``비-침입적``이라는 사실을 보여준다.
  

### 보안
* spring-security
  * 자바 애플리케이션을 안전하게 만들기 위해 필요한 ``사용자 인증(authentication)``과 ``권한 부여(authorization)`` 기능을 제공
  * ``@Secured`` 애너테이션을 사용

### JMX
* JMX(Java Management Extension,자바 관리 확장)
  * 실행 중인 애플리케이션의 상태를 모니터링 하고, 설정을 변경할 수 있게 해주는 API
  * 관리하는 클래스(서비스)를 ``Mbean(Managed Bean)``으로 클래스 인스턴스를 MBean서버에 등록, 클래스의 관련 메서드를 JMX연산으로 노출시킨다.
  * ``@ManagedResource``를 설정하면 클래스의 인스턴스를 MBean 서버에 등록할 수 있다.
  * ``@ManagedOperation``을 설정하면 @ManagedResource가 설정한 클래스의 메서드를 JMX 연산으로 노출시킬 수 있다.

### JMS
* JMS(Java Message Service,자바 메시지 서비스)
  * JMS 제공자에게 메시지를 받거나 보낼 수 있음
  * 스프링을 이용하면 직접 JMS API를 다룰 필요가 없다.

### 캐싱
* 스프링의 캐시 추상화를 사용하면 애플리케이션에서 일관성 있게 캐시를 사용할 수 있다.
  * 애플리케이션 성능을 향상시키기 위해 캐시솔루션을 사용하는 경우가 많다.
  * 스프링을 사용하면 캐시 관련 로직을 추상화함으로써 여러 다른 캐시 솔루션과 더 단순하게 상호 작용할 수 있다.
  * ``@Cachable`` 사용
***
##결론 
* 전반적으로 스프링을 사용하면 POJO에 투명하게 각종 서비스를 공급할 수 있고 개발자가 저수준 API를 자세히 알 필요가 없기때문에 개발이 편해진다.
* 하이버네이트,JSF,쿼츠,스트럿츠,EJB 등의 표준 프레임워크와도 쉽게 상호 작용한다.
* 즉, 스프링은 엔터프라이즈 애플리케이션 개발 시 이상적인 선택이다.
***
## 간단한 스프링 애플리케이션
* 애플리케이션에서 스프링 DI 기능을 사용하려면 다음 단계를 거쳐야한다.
  1. 애플리케이션에 쓰이는 여러 객체와 객체 간 의존 관계를 파악한다.
  2. 1단계에서 파악한 각 애플리케이션 객체에 상응하는 POJO 클래스를 만든다.
  3. 애플리케이션 객체 간 의존관계를 표현하는 설정 메타데이터를 만든다.
  4. 스프링 IoC 컨테이너의 인스턴스를 만들고 설정 메타데이터를 인스턴스에 전달한다.
     * ApplicationContext 객체는 스프링 컨테이너 인스턴스를 표현한다.
       * 선택기준(설정 메타데이터 정의방법(XML,애너테이션,자바코드 등)/애플리케이션 유형(웹,독립실행))
         * ClassPathXmlApplicationContext : 설정 메타데이터를 XML형태로 정의한 독립 실행 애플리케이션에 적합
         * FileSystemXmlApplicationConcetxt : 설정 메타데이터를 XML형태로 정의한 독립 실행 애플리케이션에 적합
         * XmlWebApplicationContext : 설정 메타데이터를 XML형태로 정의한 웹 애플리케이션에 적합
         * AnnotationConfigWebApplication : 자바 코드를 통해 설정 메타데이터를 정의하는 웹 애플리케이션에 적합

  5. 스프링 IoC 컨테이너 인스턴스로 애플리케이션 객체에 접근한다.